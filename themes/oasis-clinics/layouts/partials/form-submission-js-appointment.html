<script src="/build/js/intlTelInput.js"></script>

<script async>
    const input = document.querySelector("#phone");
    const errorMsg = document.querySelector("#error-msg");
    const validMsg = document.querySelector("#valid-msg");
    // initialise plugin
    const iti = window.intlTelInput(input, {
            utilsScript: "/build/js/utils.js",
            separateDialCode: false,
            initialCountry: "us",
            customPlaceholder: function(selectedCountryPlaceholder, selectedCountryData) {
                return "e.g. " + selectedCountryPlaceholder;
            },
        });
    const isValid = iti.isValidNumber();
    const errorMap = ["Invalid number", "Invalid country code", "Too short", "Too long", "Invalid number"];

    const reset = () => {
        input.classList.remove("error");
        errorMsg.innerHTML = "";
        errorMsg.classList.add("hide");
        validMsg.classList.add("hide");
        console.log('reset func')
    };
    const validateTel = () => {
        reset();
        if (input.value.trim()) {
            if (iti.isValidNumber()) {
                validMsg.classList.remove("hide");
                
            } 
        }
    }

    const handleSubmit = (e) => {
    e.preventDefault();
    reset();
    const number = iti.getNumber();
    input.value = number;
    console.log(number)
    if (input.value.trim()) {
        if (iti.isValidNumber()) {
        validMsg.classList.remove("hide");
        } else {
        input.classList.add("error");
        const errorCode = iti.getValidationError();
        errorMsg.innerHTML = `${errorMap[errorCode]} (${input.placeholder})`;
        errorMsg.classList.remove("hide");
        return false;
        }
    }

    let myForm = document.querySelector(".appointment-form");
    let formData = new FormData(myForm);
    fetch("/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(formData).toString(),
  } )
    .then(() => window.location.href = "{{printf "/successful" | relLangURL}}")
    .catch((error) => alert(error));
};
    document
  .querySelector("form")
  .addEventListener("submit", handleSubmit);

// on keyup / change flag: reset
input.addEventListener('change', validateTel);
input.addEventListener('keyup', validateTel);

</script>

